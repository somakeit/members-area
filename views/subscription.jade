extends layout

block content
  h2 Subscription
  if !loggedInUser.paidUntil || loggedInUser.paidUntil.getFullYear() < 2013
    p.text-error We have received no subscription payments from you yet (payments may take
      |  a couple of days to show up). Please set up a standing order to the details at the bottom of the page.
  else if +loggedInUser.paidUntil < +new Date()
    p.text-warning Your subscription is overdue. Please set up or check your standing order to the details at the bottom of the page.
  else
    p.text-success Your subscription is up to date - thanks very much!
    p Your next payment is due: 
      strong= formatDate(loggedInUser.paidUntil)
  h3 Payments
  if err
    p.text-error Error loading payments from DB.
  else
    if payments.length == 0
      p.text-error No payments made
    else
      table.table.table-striped
        tr
          each entry, key in paymentColumns
            th= entry.t
        for payment in payments
          tr
            each entry, key in paymentColumns
              td= entry.f(payment[key], payment)
  p.muted Remember: subscription is pay what you think the space is worth
    |  (minimum £5/mo), but we require an average of £20/member/mo to keep
    |  the space running - please be generous!
  h3 Standing order instructions
  p Please make standing orders out to the following:
  table.table.table-bordered(style='width: auto')
    tr
      th Payee name
      td So Make It Ltd.
    tr
      th Sort code
      td #{process.env.SORTCODE}
    tr
      th Account number
      td #{process.env.ACCOUNTNUMBER}
    tr
      th Payment reference
      td M#{pad(loggedInUser.id, 6)}
  p.muted Note: the payment reference is specific to your account.
